function startApp(){function a(){var a=this;$("#view-list").click(function(){$(".list-container").toggle(),$(this).text(function(a,b){return"View List"===b?"Hide List":"View List"})}),this.isMobileView=window.innerWidth<600,$(window).resize(function(){this.newViewIsMobileView=window.innerWidth<600,!this.isMobileView&&this.newViewIsMobileView&&($(".list-container").hide(),$("#view-list").text("View List")),this.isMobileView&&!this.newViewIsMobileView&&$(".list-container").show(),this.isMobileView=this.newViewIsMobileView}),this.markers=e.getMarkers(),this.placeList=ko.observableArray([]),this.makePlaceList=function(){for(a.placeList.removeAll(),i=0;i<a.markers.length;i++)a.placeList.push(a.markers[i])},this.makePlaceList(),e.setIndex(),this.selectPlace=function(){f.isNotActiveMarker(),f.isActiveMarker(f.markers[this.index]),(a.isMobileView||a.newViewIsMobileView)&&($(".list-container").hide(),$("#view-list").text("View List")),f.offsetMap(f.markers[this.index])},this.currentPlace=ko.observable(""),this.changeToFilter=function(){$("#filter-tab").addClass("tab-title--active"),$("#search-tab").removeClass("tab-title--active"),$("#filter-content").addClass("tab-content--active"),$("#search-content").removeClass("tab-content--active")},this.changeToSearch=function(){$("#search-tab").addClass("tab-title--active"),$("#filter-tab").removeClass("tab-title--active"),$("#search-content").addClass("tab-content--active"),$("#filter-content").removeClass("tab-content--active")},this.tagList=ko.observableArray([]);var c=e.getTags();for(i=0;i<c.length;i++)a.tagList.push(c[i]);this.query=ko.observable(""),this.search=function(c){for(a.placeList.removeAll(),f.infowindow.close(),i=0;i<a.markers.length;i++)a.markers[i].title.toLowerCase().indexOf(c.toLowerCase())>=0?(a.placeList.push(a.markers[i]),f.markers[i].setVisible(!0),b.setCenter(f.newtown)):f.markers[i].setVisible(!1);$(".nav-item--active").removeClass("nav-item--active")},this.query.subscribe(a.search),this.filterTag=ko.observable(""),this.filter=function(c){if(c){for(a.placeList.removeAll(),f.infowindow.close(),i=0;i<a.markers.length;i++)a.markers[i].tags.indexOf(c)>=0?(a.placeList.push(a.markers[i]),f.markers[i].setVisible(!0),b.setCenter(f.newtown)):f.markers[i].setVisible(!1);$(".nav-item--active").removeClass("nav-item--active")}},this.filterTag.subscribe(a.filter),this.resetPlaceList=function(){for(a.makePlaceList(),i=0;i<f.markers.length;i++)f.markers[i].setVisible(!0);$("#search").val(null),$("#filter").val(null),b.setCenter(f.newtown),f.infowindow.close()}}var b,c={asian:"Asian",japanese:"Japanese",thai:"Thai",cafe:"Cafe",chinese:"Chinese",yumCha:"Yum Cha",omnivoreFriendly:"Omnivore-friendly",italian:"Italian",pizza:"Pizza",multiCuisine:"Multi-cuisine",vietnamese:"Vietnamese",desserts:"Desserts",fishAndChips:"Fish & Chips"},d={markers:[{title:"Golden Lotus",position:{lat:-33.8984,lng:151.17817},tags:[c.vietnamese,c.asian]},{title:"Gigi's Pizzeria",position:{lat:-33.89925,lng:151.17759},tags:[c.pizza,c.asian]},{title:"Suzy Spoon's Vegetarian Butcher",position:{lat:-33.89261,lng:151.18687},tags:[c.cafe]},{title:"Gelato Blue",position:{lat:-33.89734,lng:151.17945},tags:[c.desserts,c.omnivoreFriendly]},{title:"Bliss & Chips",position:{lat:-33.89492,lng:151.1817},tags:[c.fishAndChips]},{title:"Vina",position:{lat:-33.89976,lng:151.17767},tags:[c.vietnamese,c.asian]},{title:"Lentil As Anything",position:{lat:-33.89966,lng:151.17764},tags:[c.multiCuisine]},{title:"Basil Pizza & Pasta",position:{lat:-33.89343,lng:151.18405},tags:[c.italian,c.pizza,c.omnivoreFriendly]},{title:"Newtown Pies",position:{lat:-33.89633,lng:151.17984},tags:[c.cafe,c.omnivoreFriendly]},{title:"Blossoming Lotus (Green Palace)",position:{lat:-33.89449,lng:151.18281},tags:[c.asian,c.thai]},{title:"Green Gourmet",position:{lat:-33.89312,lng:151.18421},tags:[c.asian,c.chinese,c.yumCha]},{title:"Superfood Sushi",position:{lat:-33.89259,lng:151.18548},tags:[c.asian,c.japanese]}]},e={init:function(){f.init()},getMarkers:function(){function a(a,b){return a.title<b.title?-1:a.title>b.title?1:0}return d.markers.sort(a),d.markers},setIndex:function(){for(i=0;i<d.markers.length;i++)d.markers[i].index=i},getHTMLList:function(){return document.getElementsByClassName("nav-item")},getTags:function(){var a=[];for(var b in c)if(Object.prototype.hasOwnProperty.call(c,b)){var d=c[b];a.push(d)}return a.sort(),a}},f={init:function(){this.newtown={lat:-33.8959847,lng:151.1788048},b=new google.maps.Map(document.getElementById("map"),{center:this.newtown,zoom:16});var a=this;for(this.markers=e.getMarkers(),this.infowindow=new google.maps.InfoWindow({maxWidth:300}),i=0;i<this.markers.length;i++)this.markers[i]=new google.maps.Marker({position:this.markers[i].position,title:this.markers[i].title,info:'<div class="infowindow"><h2>'+this.markers[i].title+'</h2><div><div id="yelp"><h3 class="source-title">Yelp</h3></div><div id="google-places"><h3 class="source-title">Google Places</h3></div></div></div>',icon:"img/map-marker.svg",tags:this.markers[i].tags,map:b}),google.maps.event.addListener(this.markers[i],"click",function(b){a.offsetMap(this);var c=this;c.previousMarker=this,a.isNotActiveMarker(),a.isActiveMarker(c);var d=e.getHTMLList();$(".nav-item--active").removeClass("nav-item--active"),$(d[this.index]).addClass("nav-item--active");var f=window.innerHeight,g=$("#sidebar").height();window.innerWidth<600&&$(".infowindow").css("max-height",.75*(f-g))});google.maps.event.addListener(b,"click",function(b){a.infowindow.close(),a.isNotActiveMarker()})},isActiveMarker:function(a){a.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){a.setAnimation(null)},2140),a.icon="img/map-marker-active.svg",this.infowindow.setContent(a.info),this.infowindow.open(b,a),this.getYelp(a),this.getGooglePlaces(a)},isNotActiveMarker:function(){for(j=0;j<this.markers.length;j++)this.markers[j].setAnimation(null),this.markers[j].icon="img/map-marker.svg"},offsetMap:function(a){var c=a.getPosition(),d=window.innerHeight,e=window.innerWidth,f=$("#sidebar").width();600>e?(b.panTo(c),b.panBy(0,0-d)):(b.panTo(c),b.panBy(0-f+this.infowindow.maxWidth/2,0-d))},getYelp:function(a){var b={consumerKey:"GIdnV7AA9LNrjdgxijDWug",consumerSecret:"h8S9YHpC0tuHtpWsnA5HXbapGZk",accessToken:"_TF1GDa2ulcE48qsFoBNefXszmtqmT5A",accessTokenSecret:"0I3ygsXN3MA7X3CXD_TSnwCPEPs",serviceProvider:{signatureMethod:"HMAC-SHA1"}},c={consumerSecret:b.consumerSecret,tokenSecret:b.accessTokenSecret};parameters=[],parameters.push(["term",a.title]),parameters.push(["location","Sydney"]),parameters.push(["callback","cb"]),parameters.push(["oauth_consumer_key",b.consumerKey]),parameters.push(["oauth_consumer_secret",b.consumerSecret]),parameters.push(["oauth_token",b.accessToken]),parameters.push(["oauth_signature_method","HMAC-SHA1"]);var d={action:"http://api.yelp.com/v2/search",method:"GET",parameters:parameters};OAuth.setTimestampAndNonce(d),OAuth.SignatureMethod.sign(d,c);var e=OAuth.getParameterMap(d.parameters);e.oauth_signature=OAuth.percentEncode(e.oauth_signature),$.ajax({url:d.action,data:e,cache:!0,dataType:"jsonp",jsonpCallback:"cb",success:function(b){var c,d=b.businesses[0].image_url,e=b.businesses[0].url,f=b.businesses[0].rating,g=b.businesses[0].rating_img_url,h=b.businesses[0].review_count,i=b.businesses[0].snippet_text;c=h>0?'<div class="info"><img class="info-image" src="'+d+'" alt="Photo from '+a.title+'"><img class="rating" src="'+g+'" alt="'+f+' star rating on Yelp"><p class="review-count">out of '+h+' reviews</p><h4>Top Review:</h4><p class="snippet">'+i+'</p><p class="centered-element-container"><a class="button--source-link" href="'+e+'" target="_blank">Read more</a></p></div><div class="logo-container"><img class="logo" srcset="img/yelp/yelp-logo-xsmall.png 1x, img/yelp/yelp-logo-xsmall@2x.png 2x" src="img/yelp/yelp-logo-xsmall.png" alt="Yelp logo"></div>':'<p class="info">Unfortunately there are no Yelp reviews for this listing. If you\'ve been here, why don\'t you <a href="'+e+'" target="_blank">write one</a>?</p>',$("#yelp").append(c)},error:function(a,b){$("#yelp").append('<p class="info">Something\'s gone wrong with our Yelp reviews. Please try again later.</p>')}})},getGooglePlaces:function(a){function c(a,b){var c;b===google.maps.places.PlacesServiceStatus.OK?d.getDetails({placeId:a[0].place_id},function(a,b){var d;d=a.rating>0&&a.rating<.5?'<p class="stars">&#9734;&#9734;&#9734;&#9734;&#9734;</p>':a.rating>=.5&&a.rating<1.5?'<p class="stars">&#9733;&#9734;&#9734;&#9734;&#9734;</p>':a.rating>=1.5&&a.rating<2.5?'<p class="stars">&#9733;&#9733;&#9734;&#9734;&#9734;</p>':a.rating>=2.5&&a.rating<3.5?'<p class="stars">&#9733;&#9733;&#9733;&#9734;&#9734;</p>':a.rating>=3.5&&a.rating<4.5?'<p class="stars">&#9733;&#9733;&#9733;&#9733;&#9734;</p>':'<p class="stars">&#9733;&#9733;&#9733;&#9733;&#9733;</p>',c=a.user_ratings_total>0?'<div class="info">'+d+'<p class="review-count">out of '+a.user_ratings_total+' ratings</p><h4>Top Review:</h4><p class="snippet">'+a.reviews[0].text+'</p><p class="centered-element-container"><a class="button--source-link" href="'+a.url+'" target="_blank">Read more</a></p></div><div class="logo-container"><img class="logo" srcset="img/google-places/powered_by_google_on_white.png 1x, img/google-places/powered_by_google_on_white@2x.png 2x" src="img/google-places/powered_by_google_on_white.png" alt="Powered by Google"></div>':'<p class="info">Unfortunately there are no Google Places reviews for this listing. If you\'ve been here, why don\'t you <a href="'+a.url+'" target="_blank">write one</a>?</p>',$('<p class="address">'+a.formatted_address+"</p>").insertAfter("h2"),$("#google-places").append(c)}):(c='<p class="info">Something\'s wrong with Google Places. Please try again later.</p>',$("#google-places").append(c))}var d=new google.maps.places.PlacesService(b);d.nearbySearch({location:f.newtown,radius:1e3,keyword:a.title},c)}};e.init(),ko.applyBindings(new a)}